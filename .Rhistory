out_varscan2 <- file.path(out_path, paste0(sample_name, "_out_varscan2"))
out_varscan2
varscan2 = '/imppc/labs/lplab/share/marc/repos/varscan/VarScan.v2.4.4.jar'
# VarScan2 calling
system(paste('java -jar', varscan2,
'somatic',
intermediate_mpileup,
out_varscan2,
'--mpileup 1',
'--min-coverage 8',
'--min-coverage-normal 8',
'--min-coverage-tumor 6',
'--min-var-freq 0.10',
'--min-freq-for-hom 0.75',
'--normal-purity 1.0',
'--tumor-purity 1.00',
'--p-value 0.99',
'--somatic-p-value 0.05',
'--strand-filter 0',
'--output-vcf'))
vcf_names <- system(paste(bcftools,
'query -l', sorted_vcf), intern = T)
bcftools = 'bcftools'
vcf_names <- system(paste(bcftools,
'query -l', sorted_vcf), intern = T)
library(RtoSge)
# alignFastqBwa
cores = 16
name = 'NET-25_ergWgsTools_alignFastqBwa'
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = 'Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/alignFastqBwa.R'
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa/to_do/to_do'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
bam <- bams[1]
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 8
name = paste0(sample_name, '_strelka2Calling')
name
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa/to_do/to_do'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
for(bam in bams){
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
# file.copy(normal_file, cluster_folder)
# file.copy(normal_file_bai, cluster_folder)
# file.copy(tumor_file, cluster_folder)
# file.copy(tumor_file_bai, cluster_folder)
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 8
name = paste0(sample_name, '_strelka2Calling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/strelka2Calling.R',
tumor_file, normal_file, sample_name)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa/to_do/to_do/to_do'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
for(bam in bams){
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
# file.copy(normal_file, cluster_folder)
# file.copy(normal_file_bai, cluster_folder)
# file.copy(tumor_file, cluster_folder)
# file.copy(tumor_file_bai, cluster_folder)
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 8
name = paste0(sample_name, '_strelka2Calling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/strelka2Calling.R',
tumor_file, normal_file, sample_name)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
tumor_file
unlink(paste0(tumor_file), '.bai')
unlink(paste0(tumor_file, '.bai'))
tumor_file
paste0(tumor_file, '.bai')
library(RtoSge)
# alignFastqBwa
cores = 16
name = 'NET-25_ergWgsTools_alignFastqBwa'
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = 'Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/alignFastqBwa.R'
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa/to_do/to_do/to_do'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
for(bam in bams){
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
# file.copy(normal_file, cluster_folder)
# file.copy(normal_file_bai, cluster_folder)
# file.copy(tumor_file, cluster_folder)
# file.copy(tumor_file_bai, cluster_folder)
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 8
name = paste0(sample_name, '_strelka2Calling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/strelka2Calling.R',
tumor_file, normal_file, sample_name)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
for(bam in bams){
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
# file.copy(normal_file, cluster_folder)
# file.copy(normal_file_bai, cluster_folder)
# file.copy(tumor_file, cluster_folder)
# file.copy(tumor_file_bai, cluster_folder)
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 8
name = paste0(sample_name, '_strelka2Calling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/strelka2Calling.R',
tumor_file, normal_file, sample_name)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
for(bam in bams){
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
# file.copy(normal_file, cluster_folder)
# file.copy(normal_file_bai, cluster_folder)
# file.copy(tumor_file, cluster_folder)
# file.copy(tumor_file_bai, cluster_folder)
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 28
name = paste0(sample_name, '_strelka2Calling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/strelka2Calling.R',
tumor_file, normal_file, sample_name)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
bam_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
bams <- list.files(bam_path,
pattern = "_BL.bam$",
full.names = T)
cluster_folder <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/bam/bwa'
for(bam in bams){
normal_file <- bam
normal_file_bai <- paste0(normal_file, '.bai')
tumor_file <- gsub('_BL.bam', '_TI.bam', bam)
tumor_file_bai <- paste0(tumor_file, '.bai')
# file.copy(normal_file, cluster_folder)
# file.copy(normal_file_bai, cluster_folder)
# file.copy(tumor_file, cluster_folder)
# file.copy(tumor_file_bai, cluster_folder)
sample_name <- gsub("_.*", '', basename(bam))
# strelka2Calling
cores = 28
name = paste0(sample_name, '_strelka2Calling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/strelka2Calling.R',
tumor_file, normal_file, sample_name)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
vcf_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2'
vcf <- list.files(bam_path,
pattern = "_PASS.vcf$",
full.names = T)
vcf <- list.files(vcf_path,
pattern = "_PASS.vcf$",
full.names = T)
vcf_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2'
vcf <- list.files(vcf_path,
pattern = "_PASS.vcf$",
full.names = T)
vcf
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
vcf_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2'
vcf <- list.files(vcf_path,
pattern = "\\*_PASS.vcf$",
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = "\\_PASS.vcf$",
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = "_PASS.vcf$",
full.names = T)
vcf
?Sys.glob
glob2rx("\\_PASS.vcf$")
vcf <- list.files(vcf_path,
pattern = glob2rx("\\_PASS.vcf$"),
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = glob2rx("*_PASS\\.vcf$"),
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = "*_PASS\\.vcf$",
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = "\\.vcf$",
full.names = T)
vcf
vcf_path
vcf <- list.files(vcf_path,
pattern = "\\..vcf$",
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = "\\.vcf$",
full.names = T)
vcf
vcf <- list.files(vcf_path,
pattern = "\\*_PASS.vcf$",
full.names = T,
recursive = T)
vcf
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern ="\\*._PASS.vcf",
full.names = T)
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern ="\\._PASS.vcf",
full.names = T)
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern ="\\*._PASS.vcf",
full.names = T)
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern = Sys.glob("*._PASS.vcf")
full.names = T)
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern = Sys.glob("*._PASS.vcf"),
full.names = T)
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern = Sys.glob("*_PASS.vcf"),
full.names = T)
list.files('/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-41_out_strelka2/results/variants',
pattern = "*\\_PASS\\.vcf",
full.names = T)
vcfs <- list.files(vcf_path,
pattern = "*\\_PASS\\.vcf",
full.names = T,
recursive = T)
vcfs
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
vcf_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2'
vcfs <- list.files(vcf_path,
pattern = "*\\_PASS\\.vcf",
full.names = T,
recursive = T)
for(vcf in vcfs){
# postCalling
cores = 1
name = paste0(sample_name, '_postCalling')
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/postCalling.R',
vcf)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
vcf_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2'
vcfs <- list.files(vcf_path,
pattern = "*\\_PASS\\.vcf",
full.names = T,
recursive = T)
for(vcf in vcfs){
sample_name <- gsub("_.*", '', basename(bam))
# postCalling
cores = 1
name = paste0('pC_', sample_name)
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/postCalling.R',
vcf)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
sample_name <- gsub("_.*", '', basename(vcf))
sample_name
paste0('pC_', sample_name)
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
vcf_path <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2'
vcfs <- list.files(vcf_path,
pattern = "*\\_PASS\\.vcf",
full.names = T,
recursive = T)
for(vcf in vcfs){
sample_name <- gsub("_.*", '', basename(vcf))
# postCalling
cores = 1
name = paste0('pC_', sample_name)
queue = 'imppcv3'
log = '/imppc/labs/lplab/share/marc/insulinomas/logs'
script = paste('Rscript /imppc/labs/lplab/share/marc/repos/ergWgsTools/tmp/postCalling.R',
vcf)
email = 'clusterigtpmsubirana@gmail.com'
RtoSge::toSge(cores = cores,
name = name,
queue = queue,
log = log,
script = script,
email = email)
}
?grep
vcf <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-11_out_strelka2/results/variants/NET-11_out_strelka2_indels_postCalling.vcf'
read.table(vcf)
vcf <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-11_out_strelka2/results/variants/NET-11_out_strelka2_indels_postCalling.vcf'
read.table(vcf)
x <- read.table(vcf)
grep(x = x, pattern = "##", invert = T)
x[grep(x = x, pattern = "##", invert = T)]
vcf <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-11_out_strelka2/results/variants/NET-11_out_strelka2_indels_postCalling.vcf'
corrected_vcf <- gsub("\\.vcf", "_corr.vcf", vcf)
system(paste('cat', vcf,
'| grep -v "##"',
'| awk \'{print $1"\t"$2"\t"$2"\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11}\'',
'>', corrected_vcf))
system(paste(perl, file.path(annovar, 'table_annovar.pl'),
corrected_vcf,
humandb,
'-buildver hg38',
'-out', out_vcf,
'-remove',
'-nastring NA',
'-thread', cores,
'-protocol',
#geneanno
paste0('refGene,',
#filter based
'exac03,avsnp150,dbnsfp33a'),
'-operation g,f,f,f'))
vcf <- '/imppc/labs/lplab/share/marc/insulinomas/processed/hg38/vcf/strelka2/strelka2/NET-11_out_strelka2/results/variants/NET-11_out_strelka2_indels_postCalling.vcf'
out_vcf <- gsub('_postCalling.vcf', '_annovarann.vcf')
out_vcf <- gsub('_postCalling.vcf', '_annovarann.vcf', vcf)
annovarAnnotation <- function(vcf,
out_vcf,
cores,
annovar='/imppc/labs/lplab/share/bin/annovar',
humandb='/imppc/labs/lplab/share/bin/annovar/humandb',
perl='perl'){
corrected_vcf <- gsub("\\.vcf", "_corr.vcf", vcf)
system(paste('cat', vcf,
'| grep -v "##"',
'| awk \'{print $1"\t"$2"\t"$2"\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11}\'',
'>', corrected_vcf))
# genebased annotation function, which annotates variants to coding and non-coding genes and
# indicates the amino acids that are affected
# annotation using three main databases: Ensembl, RefSeq and UCSC Known Gene
# Filter based annotation includes annotation to certain databases, such as gnomAD,
# dbSNP, and prediction programs to evaluate pathogenicity
system(paste(perl, file.path(annovar, 'table_annovar.pl'),
corrected_vcf,
humandb,
'-buildver hg38',
'-out', out_vcf,
'-remove',
'-nastring NA',
'-thread', cores,
'-protocol',
#geneanno
paste0('refGene,',
#filter based
'exac03,avsnp150,dbnsfp33a'),
'-operation g,f,f,f'))
unlink(corrected_vcf)
}
annovarAnnotation(vcf = vcf,
out_vcf = out_vcf,
cores = 6)
devtools::document()
devtools::document()
devtools::document()
?bwaAlignment
devtools::load_all('/imppc/labs/lplab/share/marc/repos/ergWgsTools')
devtools::load_all()
exists(type_input_file)
# define input type
type_input_file <- if(any(c('fastq', 'fq', 'gz') %in% unlist(strsplit(input_file, ".", fixed = TRUE)))) 'fastq'
input_file = fastq
fastq = "/imppc/labs/lplab/share/marc/insulinomas/raw/fastq/NET-17_BL_R1.fq.gz"
input_file = fastq
# define input type
type_input_file <- if(any(c('fastq', 'fq', 'gz') %in% unlist(strsplit(input_file, ".", fixed = TRUE)))) 'fastq'
type_input_file <- if(any('bam' %in% unlist(strsplit(input_file, ".", fixed = TRUE)))) 'bam'
if(exists(type_input_file)){message('Error: file should be BAM or FASTQ type')}
exists(type_input_file)
?exists
type_input_file
type_input_file
type_input_file
input_file
any(c('fastq', 'fq', 'gz') %in% unlist(strsplit(input_file, ".", fixed = TRUE)))
# define input type
type_input_file <- if(any(c('fastq', 'fq', 'gz') %in% unlist(strsplit(input_file, ".", fixed = TRUE)))) 'fastq'
type_input_file
# define input type
type_input_file <- if(any(c('fastq', 'fq', 'gz') %in% unlist(strsplit(input_file, ".", fixed = TRUE)))) 'fastq'
type_input_file
type_input_file
